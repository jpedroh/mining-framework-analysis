  package       com . premiumminds . billy . portugal . services . builders . impl ;   import      com . premiumminds . billy . core . exceptions . BillyValidationException ;  import      com . premiumminds . billy . core . exceptions . DuplicateCreditNoteException ;  import      com . premiumminds . billy . core . services . UID ;  import         com . premiumminds . billy . core . services . entities . documents . GenericInvoice . CreditOrDebit ;  import      com . premiumminds . billy . core . util . BillyValidator ;  import      com . premiumminds . billy . core . util . Localizer ;  import      com . premiumminds . billy . core . util . NotOnUpdate ;  import       com . premiumminds . billy . portugal . persistence . dao . DAOPTCreditNoteEntry ;  import       com . premiumminds . billy . portugal . persistence . dao . DAOPTInvoice ;  import       com . premiumminds . billy . portugal . persistence . dao . DAOPTProduct ;  import       com . premiumminds . billy . portugal . persistence . dao . DAOPTRegionContext ;  import       com . premiumminds . billy . portugal . persistence . dao . DAOPTTax ;  import       com . premiumminds . billy . portugal . persistence . entities . PTCreditNoteEntryEntity ;  import       com . premiumminds . billy . portugal . persistence . entities . PTInvoiceEntity ;  import       com . premiumminds . billy . portugal . services . builders . PTCreditNoteEntryBuilder ;  import       com . premiumminds . billy . portugal . services . entities . PTCreditNoteEntry ;   public class PTCreditNoteEntryBuilderImpl  <  TBuilder  extends  PTCreditNoteEntryBuilderImpl  < TBuilder , TEntry > ,  TEntry  extends PTCreditNoteEntry >  extends  PTGenericInvoiceEntryBuilderImpl  < TBuilder , TEntry , DAOPTCreditNoteEntry , DAOPTInvoice >  implements   PTCreditNoteEntryBuilder  < TBuilder , TEntry >  {   protected static final Localizer  LOCALIZER =  new Localizer  ( "com/premiumminds/billy/core/i18n/FieldNames" ) ;   public PTCreditNoteEntryBuilderImpl  (  DAOPTCreditNoteEntry daoPTCreditNoteEntry ,  DAOPTInvoice daoPTInvoice ,  DAOPTTax daoPTTax ,  DAOPTProduct daoPTProduct ,  DAOPTRegionContext daoPTRegionContext )  {  super  ( daoPTCreditNoteEntry , daoPTInvoice , daoPTTax , daoPTProduct , daoPTRegionContext ) ; }    @ NotOnUpdate public  @ Override TBuilder setReferenceUID  (  UID referenceUID )  {   BillyValidator . notNull  ( referenceUID ,   PTCreditNoteEntryBuilderImpl . LOCALIZER . getString  ( "field.invoice_reference" ) ) ;  PTInvoiceEntity  i =   this . daoInvoice . get  ( referenceUID ) ;   BillyValidator . found  ( i ,   PTGenericInvoiceBuilderImpl . LOCALIZER . getString  ( "field.invoice_reference" ) ) ;    this . getTypeInstance  ( ) . setReference  ( i ) ;  return  this . getBuilder  ( ) ; }    @ NotOnUpdate public  @ Override TBuilder setReason  (  String reason )  {   BillyValidator . notBlank  ( reason ,   PTCreditNoteEntryBuilderImpl . LOCALIZER . getString  ( "field.reason" ) ) ;    this . getTypeInstance  ( ) . setReason  ( reason ) ;  return  this . getBuilder  ( ) ; }    @ Override protected void validateInstance  ( )  throws BillyValidationException  {    this . getTypeInstance  ( ) . setCreditOrDebit  (  CreditOrDebit . DEBIT ) ;   super . validateInstance  ( ) ;  PTCreditNoteEntryEntity  cn =  this . getTypeInstance  ( ) ;   BillyValidator . mandatory  (  cn . getReference  ( ) ,   PTCreditNoteEntryBuilderImpl . LOCALIZER . getString  ( "field.invoice_reference" ) ) ;   BillyValidator . mandatory  (  cn . getReason  ( ) ,   PTCreditNoteEntryBuilderImpl . LOCALIZER . getString  ( "field.reason" ) ) ;   this . ValidatePTCreditNoteEntry  ( cn ) ; }   private void ValidatePTCreditNoteEntry  (  PTCreditNoteEntryEntity cn )  {  if  (   daoEntry . checkCreditNote  (  cn . getReference  ( ) ) != null )  {  throw  new DuplicateCreditNoteException  ( ) ; } }    @ Override protected PTCreditNoteEntryEntity getTypeInstance  ( )  {  return  ( PTCreditNoteEntryEntity )  super . getTypeInstance  ( ) ; } }